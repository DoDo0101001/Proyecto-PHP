CREATE DATABASE TiendaDeMascotas;
USE TiendaDeMascotas;

-- Tabla de Clientes con CURP
CREATE TABLE Clientes (
  ID_Persona INT PRIMARY KEY AUTO_INCREMENT,
  CURP VARCHAR(18) NOT NULL,
  Cedula VARCHAR(20),
  Nombre VARCHAR(50)
);

-- Tabla de Mascotas
CREATE TABLE Mascotas (
  ID_Mascota INT PRIMARY KEY AUTO_INCREMENT,
  Cod_Mascota VARCHAR(20),
  Dueño INT,
  FOREIGN KEY (Dueño) REFERENCES Clientes(ID_Persona)
);

-- Tabla de Tipo de Mascotas
CREATE TABLE Tipo_Mascotas (
  ID_TipoMascota INT PRIMARY KEY AUTO_INCREMENT,
  TipoDeMascota VARCHAR(50),
  Nombre VARCHAR(100),
  Genero VARCHAR(10),
  Edad INT,
  Mascota INT,
  FOREIGN KEY (Mascota) REFERENCES Mascotas(ID_Mascota)
);

-- Tabla de Facturas
CREATE TABLE Facturas (
  ID_Factura INT PRIMARY KEY AUTO_INCREMENT,
  Codigo_Factura VARCHAR(50),
  Fecha DATE,
  TOTAL DECIMAL(10, 2),
  Cliente INT,
  Mascota INT,
  Servicio INT,
  Pago INT,
  FOREIGN KEY (Cliente) REFERENCES Clientes(ID_Persona),
  FOREIGN KEY (Mascota) REFERENCES Mascotas(ID_Mascota),
  FOREIGN KEY (Servicio) REFERENCES Servicios(ID_Servicio),
  FOREIGN KEY (Pago) REFERENCES Metodo_Pago(ID_Pago)
);

-- Tabla de Servicios
CREATE TABLE Servicios (
  ID_Servicio INT PRIMARY KEY AUTO_INCREMENT,
  Nombre_Servicio VARCHAR(100),
  Precio DECIMAL(10, 2),
  Estado VARCHAR(20),
  Mascota INT,
  FOREIGN KEY (Mascota) REFERENCES Mascotas(ID_Mascota)
);

-- Tabla de Métodos de Pago
CREATE TABLE Metodo_Pago (
  ID_Pago INT PRIMARY KEY AUTO_INCREMENT,
  Tipo_Pago VARCHAR(50)
);

-- Tabla de Tipos de Servicios
CREATE TABLE Tipo_Servicios (
  ID_TipoServicio INT PRIMARY KEY AUTO_INCREMENT,
  Servicio VARCHAR(100)
);

-- Índices para optimizar las búsquedas
CREATE INDEX idx_usuario_mascota ON Mascotas(Dueño);
CREATE INDEX idx_factura_cliente ON Facturas(Cliente);

-- Procedimiento almacenado para insertar una factura
DELIMITER //
CREATE PROCEDURE InsertarFactura(
    IN p_Codigo_Factura VARCHAR(50), 
    IN p_Fecha DATE, 
    IN p_Total DECIMAL(10, 2),
    IN p_ID_Cliente INT,
    IN p_ID_Mascota INT,
    IN p_ID_Servicio INT,
    IN p_ID_Pago INT
)
BEGIN
  INSERT INTO Facturas(Codigo_Factura, Fecha, TOTAL, Cliente, Mascota, Servicio, Pago)
  VALUES(p_Codigo_Factura, p_Fecha, p_Total, p_ID_Cliente, p_ID_Mascota, p_ID_Servicio, p_ID_Pago);
END //
DELIMITER ;
